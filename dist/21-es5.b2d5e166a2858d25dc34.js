function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var o,n=_getPrototypeOf(t);if(e){var r=_getPrototypeOf(this).constructor;o=Reflect.construct(n,arguments,r)}else o=n.apply(this,arguments);return _possibleConstructorReturn(this,o)}}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{xjHI:function(t,e,o){"use strict";o.r(e),o.d(e,"CreatePollModule",(function(){return q}));var n=o("sYmb"),r=o("TEn/"),i=o("tyNb"),a=o("ofXK"),s=o("3Pt+"),l=o("mrSG"),c=o("kt0X"),u=o("NQLq"),p=o("fkgO"),b=o("vifI"),f=o("F8ix"),d=o("ec16"),m=[{name:"pollName"},{name:"groupPoll"},{name:"questions"}],h=o("fXoL"),g=o("iHIt");function v(t,e){if(1&t&&(h.Ob(0,"ion-select-option",15),h.mc(1),h.Nb()),2&t){var o=e.$implicit;h.ec("value",o.groupName),h.zb(1),h.oc("",o.groupName," ")}}function O(t,e){if(1&t){var o=h.Pb();h.Mb(0),h.Ob(1,"ion-item"),h.Ob(2,"ion-label"),h.mc(3),h.Nb(),h.Ob(4,"ion-icon",17),h.Wb("click",(function(){h.ic(o);var t=e.index;return h.Yb(2).deleteQuestion(t)})),h.Nb(),h.Nb(),h.Lb()}if(2&t){var n=e.$implicit;h.zb(3),h.nc(n)}}function y(t,e){if(1&t&&(h.Ob(0,"ion-list"),h.lc(1,O,5,1,"ng-container",16),h.Nb()),2&t){var o=h.Yb();h.zb(1),h.dc("ngForOf",o.questionData)}}function N(t,e){if(1&t){var o=h.Pb();h.Ob(0,"ion-button",21),h.Wb("click",(function(){return h.ic(o),h.Yb(2).deletePoll()})),h.mc(1),h.Zb(2,"translate"),h.Nb()}if(2&t){var n=h.Yb(2);h.ec("disabled",n.getDisableDelete()),h.zb(1),h.oc(" ",h.ac(2,2,"commons.delete")," ")}}function P(t,e){if(1&t){var o=h.Pb();h.Ob(0,"ion-button",21),h.Wb("click",(function(){return h.ic(o),h.Yb(2).navigateToPoll()})),h.mc(1),h.Zb(2,"translate"),h.Nb()}if(2&t){var n=h.Yb(2);h.ec("disabled",n.getDisableDelete()),h.zb(1),h.oc(" ",h.ac(2,2,"commons.showData")," ")}}function _(t,e){if(1&t){var o=h.Pb();h.Ob(0,"div",18),h.Ob(1,"ion-button",19),h.Wb("click",(function(){return h.ic(o),h.Yb().saveData()})),h.mc(2),h.Zb(3,"translate"),h.Nb(),h.lc(4,N,3,4,"ion-button",20),h.lc(5,P,3,4,"ion-button",20),h.Nb()}if(2&t){var n=h.Yb();h.zb(1),h.dc("disabled",!n.formGroup.valid),h.zb(1),h.oc(" ",h.ac(3,4,n.isUpdate?"commons.update":"commons.create")," "),h.zb(2),h.dc("ngIf",n.isUpdate),h.zb(1),h.dc("ngIf",n.isUpdate)}}var k,w,D,C=((k=function(t){_inherits(o,t);var e=_createSuper(o);function o(t,n,r,i,a,s,l){var c;return _classCallCheck(this,o),(c=e.call(this,i,a,s)).formBuilder=t,c.router=n,c.toastController=r,c.store=i,c.utils=a,c.translateService=s,c.activatedRoute=l,c.isUpdate=!1,c.groupData=[],c.questionData=[],c.compareWithGroup=function(t,e){return t===e},c.formGroup=c.utils.buildForm(m),c.utils.resetForm(c.formGroup),c}return _createClass(o,[{key:"saveData",value:function(){var t={_id:this.pollId,pollName:this.formGroup.get("pollName").value?this.formGroup.get("pollName").value:null,groupPoll:this.formGroup.get("groupPoll").value?this.formGroup.get("groupPoll").value:null,questions:this.questionData||null,owner:JSON.parse(sessionStorage.user).email};this.isUpdate?this.store.dispatch(new b.g(t)):(delete t._id,this.store.dispatch(new b.a(t)))}},{key:"pollCreated",value:function(){this.presentToast(),this.router.navigate(["/tabs"])}},{key:"getDisableDelete",value:function(){var t=this,e=!0;return this.groupData&&this.formGroup.get("groupPoll").value&&this.groupData.forEach((function(o){o.groupName===t.formGroup.get("groupPoll").value&&o.owner===JSON.parse(sessionStorage.user).email&&(t.formGroup.get("groupPoll").enable(),e=!1)})),e}},{key:"showButtons",value:function(){return!this.isUpdate||this.groupData&&this.groupData[0]&&this.groupData[0].owner===JSON.parse(sessionStorage.user).email}},{key:"deletePoll",value:function(){this.store.dispatch(new b.b({_id:this.pollId}))}},{key:"addQuestion",value:function(){this.formGroup.get("questions").value&&(this.questionData.push(this.formGroup.get("questions").value),this.formGroup.get("questions").setValue(""))}},{key:"deleteQuestion",value:function(t){this.questionData.splice(t,1)}},{key:"navigateToPoll",value:function(){this.store.dispatch(new b.d({_id:this.pollId,showResults:!0}))}},{key:"updateForm",value:function(t){this.formGroup.get("pollName").setValue(t.pollName),this.formGroup.get("groupPoll").setValue(t.groupPoll),this.questionData=t.questions}},{key:"presentToast",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.toastController.create({message:this.translateService.instant("createPoll.pollCreated"),duration:2e3});case 2:t.sent.present();case 3:case"end":return t.stop()}}),t,this)})))}},{key:"ngOnInit",value:function(){var t=this;this.store.pipe(Object(c.p)(f.a)).subscribe((function(e){e.length>0&&t.isUpdate&&t.updateForm(e[0])})),this.store.pipe(Object(c.p)(p.a)).subscribe((function(e){Array.isArray(e)&&(t.groupData=e)})),this.activatedRoute.url.subscribe((function(e){var o=t.router.getCurrentNavigation().extras.state;t.isUpdate=!(!o||!o.data),t.store.dispatch(new u.f({owner:JSON.parse(sessionStorage.user).email})),t.questionData=[],t.isUpdate?(t.formGroup.get("groupPoll").disable(),t.pollId=o.data._id,t.store.dispatch(new b.d({_id:o.data._id}))):t.utils.resetForm(t.formGroup)}))}}]),o}(d.a)).\u0275fac=function(t){return new(t||k)(h.Jb(s.a),h.Jb(i.g),h.Jb(r.I),h.Jb(c.h),h.Jb(g.a),h.Jb(n.d),h.Jb(i.a))},k.\u0275cmp=h.Db({type:k,selectors:[["app-create-poll"]],features:[h.wb],decls:31,vars:25,consts:[[3,"translucent"],["slot","start"],["defaultHref","/tabs/principal-menu"],[3,"fullscreen"],[3,"formGroup"],["lines","full"],["position","floating"],["type","text","required","","formControlName","pollName"],["required","","formControlName","groupPoll",3,"okText","cancelText","compareWith"],["value",""],[3,"value",4,"ngFor","ngForOf"],["type","text","formControlName","questions"],["name","add-outline","slot","end",3,"click"],[4,"ngIf"],["padding","",4,"ngIf"],[3,"value"],[4,"ngFor","ngForOf"],["name","close-outline","slot","end",3,"click"],["padding",""],["block","","type","submit",3,"disabled","click"],["type","submit","color","danger",3,"disabled","click",4,"ngIf"],["type","submit","color","danger",3,"disabled","click"]],template:function(t,e){1&t&&(h.Ob(0,"ion-header",0),h.Ob(1,"ion-toolbar"),h.Ob(2,"ion-buttons",1),h.Kb(3,"ion-back-button",2),h.Ob(4,"ion-title"),h.mc(5),h.Zb(6,"translate"),h.Nb(),h.Nb(),h.Nb(),h.Nb(),h.Ob(7,"ion-content",3),h.Ob(8,"form",4),h.Ob(9,"ion-item",5),h.Ob(10,"ion-label",6),h.mc(11),h.Zb(12,"translate"),h.Nb(),h.Kb(13,"ion-input",7),h.Nb(),h.Ob(14,"ion-item",5),h.Ob(15,"ion-label",6),h.mc(16),h.Zb(17,"translate"),h.Nb(),h.Ob(18,"ion-select",8),h.Zb(19,"translate"),h.Zb(20,"translate"),h.Kb(21,"ion-select-option",9),h.lc(22,v,2,2,"ion-select-option",10),h.Nb(),h.Nb(),h.Ob(23,"ion-item",5),h.Ob(24,"ion-label",6),h.mc(25),h.Zb(26,"translate"),h.Nb(),h.Kb(27,"ion-input",11),h.Ob(28,"ion-icon",12),h.Wb("click",(function(){return e.addQuestion()})),h.Nb(),h.Nb(),h.lc(29,y,2,1,"ion-list",13),h.lc(30,_,6,6,"div",14),h.Nb(),h.Nb()),2&t&&(h.dc("translucent",!0),h.zb(5),h.nc(h.ac(6,13,e.isUpdate?"createPoll.titleUpdate":"createPoll.title")),h.zb(2),h.dc("fullscreen",!0),h.zb(1),h.dc("formGroup",e.formGroup),h.zb(3),h.nc(h.ac(12,15,"createPoll.pollName")),h.zb(5),h.nc(h.ac(17,17,"createPoll.groupPoll")),h.zb(2),h.ec("okText",h.ac(19,19,"commons.select")),h.ec("cancelText",h.ac(20,21,"commons.cancel")),h.dc("compareWith",e.compareWithGroup),h.zb(4),h.dc("ngForOf",e.groupData),h.zb(3),h.nc(h.ac(26,23,"createPoll.questions")),h.zb(4),h.dc("ngIf",e.questionData),h.zb(1),h.dc("ngIf",e.showButtons()))},directives:[r.l,r.B,r.f,r.c,r.d,r.A,r.j,s.k,s.h,s.c,r.o,r.p,r.n,r.H,s.j,s.g,s.b,r.u,r.G,r.v,a.i,r.m,a.j,r.q,r.e],pipes:[n.c],styles:[""]}),k),G=[{path:"",component:C}],z=((D=function t(){_classCallCheck(this,t)}).\u0275mod=h.Hb({type:D}),D.\u0275inj=h.Gb({factory:function(t){return new(t||D)},imports:[[i.k.forChild(G)],i.k]}),D),q=((w=function t(){_classCallCheck(this,t)}).\u0275mod=h.Hb({type:w}),w.\u0275inj=h.Gb({factory:function(t){return new(t||w)},imports:[[r.C,a.b,s.d,s.i,i.k.forChild([{path:"",component:C}]),z,n.b]]}),w)}}]);